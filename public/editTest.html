<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="game_stats.css" />
    <link type="text/css" rel="stylesheet" href="nav.css" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Edit Game Stats</title>
    <script type="text/javascript">
    var users = [
    {
        "fname":"Mati",
        "lname":"Kucz",
        "email": "mkucz@ucsd.edu",
        "type":"coach",
        "password":"secret"
    },
    {
        "fname":"Raymond",
        "lname":"Ho",
        "email": "r4ho@ucsd.edu",
        "type":"parent",
        "password":"pizza"
    }
];

var team = {
    "name": "MBR",
    "location": "UC San Diego, 9500 Gilman Drive",
    "players":[
        {
            "fname":"Brian",
            "lname":"Thai",
            "email": "brthair4ho@ucsd.edu",
            "dob": "1994-10-11",
            "jerseynumber":"11",
            "position":"midfield",
            "pic":"/",
            "captain":"false",
            "starter":"true",
            "stats":{
                    'assist':0,
                    'goal':0,
                    'shot':0,
                    'onGoal':0,
                    'foul':0,
                    'red':0,
                    'yellow':0,
                    'corner':0,
                    'gKick':0,
                    'throw':0,
                    'pen':0
                }      
        },
        {
            "fname":"Thomas",
            "lname":"Powell",
            "email": "tpowell@ucsd.edu",
            "dob":"1974-10-11   ",
            "jerseynumber":"4",
            "position":"defence",
            "pic":"/",
            "captain":"true",
            "starter":"true",
            "stats":{
                'assist':0,
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            } 
        }
    ],

    "schedule":[
        {
            "type": "practice",
            "opponent": "N/A",
            "time":"8:00 PT",
            "date":"2017-11-15",
            "location":"home"
        },
        {
            "type": "match",
            "opponent": "UC Berkley",
            "time":"20:00 PT",
            "date":"2017-11-16",
            "location":"home",
            "statsFor":{
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            },
            "statsAgainst":{
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            } },
        {
            "type": "practice",
            "opponent": "N/A",
            "time":"18:00 PT",
            "date":"2017-11-17",
            "location":"home",
            "result":"N/A"            
        },
        {
            "type": "match",
            "opponent": "Gooners",
            "time":"18:00 PT",
            "date":"2017-11-23",
            "location":"away",
            "statsFor":{
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            },
            "statsAgainst":{
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            }
        },
        {
            "type": "match",
            "opponent": "N/A",
            "time":"18:00 PT",
            "date":"2017-11-30",
            "location":"away",
            "statsFor":{
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            },
            "statsAgainst":{
                'goal':0,
                'shot':0,
                'onGoal':0,
                'foul':0,
                'red':0,
                'yellow':0,
                'corner':0,
                'gKick':0,
                'throw':0,
                'pen':0
            } }
    ]
};

localStorage.setItem("users", JSON.stringify(users));
localStorage.setItem("team", JSON.stringify(team));</script>
    
</head>

<body style="text-align:center">
    <header id="topPage">
        <h1>Team MBR</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="viewSchedule.html">Schedule</a>
            <a href="viewSquad.html">Squad</a>
        </nav>
    </header>
    <h4>MBR vs. <div id="opponentName" style="display:inline;">Enemies</div></h4>
    <aside>-</aside>

    <button type="button" class="minus left" onClick="assignStat('minus','goal', 'home')" data-type="minus" data-field="">-</button>
    <button type="button" class="plus left"  onClick="assignStat('plus', 'goal', 'home')" data-type="plus" data-field="">+</button>
    
    <button type="button" class="plus right" onClick="assignStat('plus', 'goal', 'away')" data-type="plus" data-field="">+</button>
    <button type="button" class="minus right" onClick="assignStat('minus', 'goal', 'away')" data-type="minus" data-field="">-</button>
    <table>
            <thead><tr><th>Goals</th></tr></thead>
            <tbody><tr><td id="homegoal">3</td><td id="awaygoal">1</td></tr></tbody>
        </table>
        <form method="POST" style="visibility:hidden;" id="goal" name="playergoal" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
       
        <button type="button" class="minus left" onClick="assignStat('minus', 'shot', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'shot', 'home')" data-type="plus" data-field="">+</button>

        <button type="button" class="plus right" onClick="assignStat('plus', 'shot', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'shot', 'away')" data-type="minus" data-field="">-</button>
        <table>
                <thead><tr><th>Shots (on Goal)</th></tr></thead>
                <tbody><tr><td id="homeshot">1(1)</td><td id="awayshot">1(0)</td></tr></tbody>
            </table>
            <form method="POST" id="shot" style="visibility:hidden;" name="playershot" onsubmit="send()" label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label>
                <input type="checkbox" id="shotOnGoal" name="onGoal" value="onGoal">
                <label for="shotOnGoal">On Goal?</label><input type="submit" value="save"></input></form>
            

        <button type="button" class="minus left" onClick="assignStat('minus', 'foul', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'foul', 'home')" data-type="plus" data-field="">+</button>
        <button type="button" class="plus right" onClick="assignStat('plus', 'foul', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'foul', 'away')" data-type="minus" data-field="">-</button>
        <table class="fouls">
                <thead><tr><th>Fouls</th></tr></thead>
                <tbody><tr><td id="homefoul">1</td><td id="awayfoul">2</td></tr></tbody>
            </table>
            <form method="POST" id="foul" style="visibility:hidden;" name="playerfoul" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
            

        <button type="button" class="minus left" onClick="assignStat('minus', 'red', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'red', 'home')" data-type="plus" data-field="">+</button>
        <button type="button" class="plus right" onClick="assignStat('plus', 'red', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'red', 'away')" data-type="minus" data-field="">-</button>
             <table>
                <thead><tr><th>Red Cards</th></tr></thead>
                <tbody><tr><td id="homered">0</td><td id="awayred">0</td></tr></tbody>
            </table>
            <form method="POST" id="red" style="visibility:hidden;"  name="playerred" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
            
        <button type="button" class="minus left" onClick="assignStat('minus', 'yellow', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'yellow', 'home')" data-type="plus" data-field="">+</button>
        <button type="button" class="plus right" onClick="assignStat('plus', 'yellow', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'yellow', 'away')" data-type="minus" data-field="">-</button>
        <table class="yellow">
                <thead><tr><th>Yellow Cards</th></tr></thead>
                <tbody><tr><td id="homeyellow">1</td><td id="awayyellow">1</td></tr></tbody>
            </table>
            <form method="POST" id="yellow" style="visibility:hidden;" name="playeryellow" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
            
        <button type="button" class="minus left" onClick="assignStat('minus', 'corner', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'corner', 'home')" data-type="plus" data-field="">+</button>
        <button type="button" class="plus right" onClick="assignStat('plus', 'corner', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'corner', 'away')" data-type="minus" data-field="">-</button>
        <table>
                <thead><tr><th>Corner Kicks</th></tr></thead>
                <tbody><tr><td id="homecorner">2</td><td id="awaycorner">2</td></tr></tbody>
            </table>
            <form method="POST" id="corner" style="visibility:hidden;" name="playercorner" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
            
        <button type="button" class="minus left" onClick="assignStat('minus', 'gKick', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'gKick', 'home')" data-type="plus" data-field="">+</button>
        <button type="button" class="plus right" onClick="assignStat('plus', 'gKick', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'gKick', 'away')" data-type="minus" data-field="">-</button>
        <table class="goalkicks">
                <thead><tr><th>Goal Kicks</th></tr></thead>
                <tbody><tr><td id="homegKick">2</td><td id="awaygKick">2</td></tr></tbody>
            </table>
            <form method="POST" id="gKick" style="visibility:hidden;" name="playergKick" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
            
        <button type="button" class="minus left" onClick="assignStat('minus', 'throw', 'home')" data-type="minus" data-field="">-</button>
        <button type="button" class="plus left" onClick="assignStat('plus', 'throw', 'home')" data-type="plus" data-field="">+</button>
        <button type="button" class="plus right" onClick="assignStat('plus', 'throw', 'away')" data-type="plus" data-field="">+</button>
        <button type="button" class="minus right" onClick="assignStat('minus', 'throw', 'away')" data-type="minus" data-field="">-</button>
             <table>
                <thead><tr><th>Throw Ins</th></tr></thead>
                <tbody><tr><td id="homethrow">5</td><td id="awaythrow">5</td></tr></tbody>
            </table>
            <form method="POST" id="throw" style="visibility:hidden;" name="playerthrow" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
            
            <button type="button" class="minus left" onClick="assignStat('minus', 'pen', 'home')" data-type="minus" data-field="">-</button>
            <button type="button" class="plus left" onClick="assignStat('plus', 'pen', 'home')" data-type="plus" data-field="">+</button>
            <button type="button" class="plus right" onClick="assignStat('plus', 'pen', 'away')" data-type="plus" data-field="">+</button>
            <button type="button" class="minus right" onClick="assignStat('minus', 'pen', 'away')" data-type="minus" data-field="">-</button>
                 <table>
                    <thead><tr><th>Penalties</th></tr></thead>
                    <tbody><tr><td id="homepen">0</td><td id="awaypen">0</td></tr></tbody>
                </table>
                <form method="POST" id="pen" style="visibility:hidden;" name="playerpen" onsubmit="send()"><label>Assign to Player:<select name="player" class="playerSelect"><option value="-1">no player</option></select></label><input type="submit" value="save"></input></form>
                
    <script type="text/javascript"> 
    var url = window.location.href;
                var i = url.substr(url.length-1,1);
                i = parseInt(i);
                var match = team.schedule[i];        
        var homeTeam = ["homegoal", "homeshot", "homeonGoal", "homefoul", "homered", "homeyellow", "homecorner", "homegKick", "homethrow", "homepen"];
        var awayTeam = ["awaygoal", "awayshot", "awayonGoal", "awayfoul", "awayred", "awayyellow", "awaycorner", "awaygKick", "awaythrow","awaypen"];
        var refreshStats =["goal", "shot", "onGoal", "foul", "red", "yellow", "corner", "gKick", "throw", "pen"];

        refreshAll();
        updateHtml();

    function updateHtml(){
        var team = JSON.parse(localStorage.getItem("team"));
             var sel = document.getElementsByName("player");

             for(var j=0; j<sel.length; j++){
             for(var i = 0; i<team.players.length; i++){
             var option = document.createElement("option");
                
                option.text = team.players[i].lname +'-'+team.players[i].jerseynumber;
                option.value = team.players[i].jerseynumber;
                sel[j].add(option);
            }
        }
        
        var opposition = team.schedule[i].opponent;
        (document.getElementById("opponentName")).innerHTML = opposition;
        var el = document.getElementsByTagName("aside")[0];
                el.innerHTML = match.date;

    }
    
        function refreshAll(){
            for(var i = 0; i<homeTeam.length; i++){
                refresh(refreshStats[i], "home");
                refresh(refreshStats[i], "away");
            }
        }

        function refresh(stat, team){
            var el = document.getElementById(team+stat);
            var value;
            if(team === "home") value = match.statsFor[stat];
            else value = match.statsAgainst[stat]

            if(el !=null){
                    if(el.id.includes("shot")){
                        el.innerHTML = value +' ('+match.statsFor.onGoal+')';
                    }
                    else{
                        el.innerHTML = value;  
                    }
                }
        }

        function getCurrDate(){
            var now = new Date();
            var year = now.getFullYear();
            var month = now.getMonth()+1; //months start at 0
            var day = now.getDate();

            return year+'-'+month+'-'+day;
        }

            var matchDate = team.schedule[i].date;

            var sendData = {
                "action":0,
                "assign":0,
                "teamAssign":0
            };

           function assignStat(action, assign, teamAssign){ //intermediate step before assigning player
               console.debug("assignStat");
               if(teamAssign === "away"){
                   submit(matchDate, -1, action, assign, teamAssign);
                   return;
                }//dont assign to players for opposing team
                
                else{
                    sendData["action"] = action;
                    sendData["assign"] = assign;
                    sendData["teamAssign"] = teamAssign;
                }

                console.log(sendData);
                document.getElementById(assign).style.visibility = "visible";
            }

            function send(){
                var number = document.forms["player"+sendData["assign"]]["player"].value;
                console.log("send: "+number);
                submit(matchDate, number, sendData["action"], sendData["assign"], sendData["teamAssign"]);
            }

            /*
action: increase or decrease
type:
method:

*/

var type = {
    'goal':0,
    'shot':1,
    'onGoal':2,
    'foul':3,
    'red':4,
    'yellow':5,
    'corner':6,
    'gKick':7,
    'throw':8,
    'pen':9
}
var increment;


function submit(matchDate, number, action, assign, team){ 
    console.log("submit");  
    
   if(action === "plus") increment = 1;
   else increment = -1;  
 
    if(number !== -1 && team !== "away"){        
        associateToPlayer(number, assign, increment);
    }
    associateToTeam(matchDate, assign, increment, team);
    //TODO, would need to fix this to have it assigned to correct match

    refresh(assign, team);
    console.debug(number+assign+action+team);
}

function associateToPlayer(id, type, action){
   for(var i = 0; i<team.players.length; i++){
       if(team.players[i].jerseynumber == id){
           team.players[i].stats[type] += increment;

           console.log(team.players[i].stats);
           
           localStorage.setItem("team", JSON.stringify(team));
           return;
       }
   }
}

function associateToTeam(date, data, action, teamLoc){
        if(team.schedule[i].type === "match" && team.schedule[i].date == date){
            if(teamLoc ==="home") team.schedule[i].statsFor[data] += action;
            else team.schedule[i].statsAgainst[data] += action;
        }
            localStorage.setItem("team", JSON.stringify(team));
            return;
        }
        </script>
</body>
</html>